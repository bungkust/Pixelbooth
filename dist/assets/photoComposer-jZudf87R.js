import{f as W}from"./index-DVXM7ON3.js";let p=null;async function R(){if(p)return p;try{const n=(await(await fetch("/config.txt")).text()).split(`
`);let e="Pixel Booth",c="2025";for(const o of n){const r=o.trim();r.startsWith("MAIN_TEXT=")?e=r.substring(10).trim():r.startsWith("SUB_TEXT=")&&(c=r.substring(9).trim())}return p={mainText:e,subText:c},p}catch(l){return console.warn("Failed to load config.txt, using defaults:",l),p={mainText:"Pixel Booth",subText:"2025"},p}}async function $(l,m,n){console.log("Composing result for review...");const e=await R();console.log("Config loaded:",e);const c=500,o=12,r=8,y=c-o*2,T=y,a=40,h=e.mainText&&e.mainText.trim()||e.subText&&e.subText.trim()?60:0;let g=o+h+T+a+o,C=[];if(n.layout==="vertical"){g=o+h+T*n.photoCount+r*(n.photoCount-1)+a+o;for(let t=0;t<n.photoCount;t++)C.push({x:o,y:o+h+t*(T+r)})}else if(n.layout==="horizontal"){const t=(c-o*2-r*(n.photoCount-1))/n.photoCount;g=o+h+t+a+o;for(let s=0;s<n.photoCount;s++)C.push({x:o+s*(t+r),y:o+h})}else if(n.layout==="grid"){const t=n.photoCount===4?2:n.photoCount===6?3:2,s=Math.ceil(n.photoCount/t),f=(c-o*2-r*(t-1))/t,u=f;g=o+h+u*s+r*(s-1)+a+o;for(let x=0;x<n.photoCount;x++){const E=x%t,w=Math.floor(x/t);C.push({x:o+E*(f+r),y:o+h+w*(u+r)})}}const i=l.createGraphics(c,g);if(i.background(255),e.mainText&&e.mainText.trim()||e.subText&&e.subText.trim()){i.fill(0),i.noStroke(),i.textAlign(l.CENTER,l.CENTER),i.textFont("monospace");const t=o+h/2;e.mainText&&e.mainText.trim()&&(i.textSize(24),i.text(e.mainText.trim(),c/2,t-8)),e.subText&&e.subText.trim()&&(i.textSize(16),i.text(e.subText.trim(),c/2,t+12))}for(let t=0;t<n.photoCount;t++){const s=C[t];console.log(`Applying FS dither to frame ${t}...`);const f=W(l,m[t]);if(console.log(`Dither complete for frame ${t}.`),n.layout==="horizontal"){const u=(c-o*2-r*(n.photoCount-1))/n.photoCount;i.image(f,s.x,s.y,u,u)}else if(n.layout==="grid"){const u=n.photoCount===4?2:n.photoCount===6?3:2,x=(c-o*2-r*(u-1))/u;i.image(f,s.x,s.y,x,x)}else i.image(f,s.x,s.y,y,T)}const S=g-o-a;i.fill(0),i.noStroke(),i.textAlign(l.CENTER,l.CENTER),i.textFont("monospace"),i.textSize(14);const d=new Date,b=`PIXEL BOOTH // ${`${d.getFullYear()}.${(d.getMonth()+1).toString().padStart(2,"0")}.${d.getDate().toString().padStart(2,"0")}`}`;return i.text(b,c/2,S+a/2),console.log("Composing complete for review. Ready for review."),i}async function z(l,m,n){console.log("Composing result...");const e=await R();console.log("Config loaded:",e);const c=1024,o=24,r=16,y=c-o*2,T=y,a=80,h=e.mainText&&e.mainText.trim()||e.subText&&e.subText.trim()?120:0;let g=o+h+T+a+o,C=[];if(n.layout==="vertical"){g=o+h+T*n.photoCount+r*(n.photoCount-1)+a+o;for(let t=0;t<n.photoCount;t++)C.push({x:o,y:o+h+t*(T+r)})}else if(n.layout==="horizontal"){const t=(c-o*2-r*(n.photoCount-1))/n.photoCount;g=o+h+t+a+o;for(let s=0;s<n.photoCount;s++)C.push({x:o+s*(t+r),y:o+h})}else if(n.layout==="grid"){const t=n.photoCount===4?2:n.photoCount===6?3:2,s=Math.ceil(n.photoCount/t),f=(c-o*2-r*(t-1))/t,u=f;g=o+h+u*s+r*(s-1)+a+o;for(let x=0;x<n.photoCount;x++){const E=x%t,w=Math.floor(x/t);C.push({x:o+E*(f+r),y:o+h+w*(u+r)})}}const i=l.createGraphics(c,g);if(i.background(255),e.mainText&&e.mainText.trim()||e.subText&&e.subText.trim()){i.fill(0),i.noStroke(),i.textAlign(l.CENTER,l.CENTER),i.textFont("monospace");const t=o+h/2;e.mainText&&e.mainText.trim()&&(i.textSize(48),i.text(e.mainText.trim(),c/2,t-15)),e.subText&&e.subText.trim()&&(i.textSize(32),i.text(e.subText.trim(),c/2,t+25))}for(let t=0;t<n.photoCount;t++){const s=C[t];console.log(`Applying FS dither to frame ${t}...`);const f=W(l,m[t]);if(console.log(`Dither complete for frame ${t}.`),n.layout==="horizontal"){const u=(c-o*2-r*(n.photoCount-1))/n.photoCount;i.image(f,s.x,s.y,u,u)}else if(n.layout==="grid"){const u=n.photoCount===4?2:n.photoCount===6?3:2,x=(c-o*2-r*(u-1))/u;i.image(f,s.x,s.y,x,x)}else i.image(f,s.x,s.y,y,T)}const S=g-o-a;i.fill(0),i.noStroke(),i.textAlign(l.CENTER,l.CENTER),i.textFont("monospace"),i.textSize(28);const d=new Date,b=`PIXEL BOOTH // ${`${d.getFullYear()}.${(d.getMonth()+1).toString().padStart(2,"0")}.${d.getDate().toString().padStart(2,"0")}`}`;return i.text(b,c/2,S+a/2),console.log("Composing complete. Ready for review."),i}export{z as composeResult,$ as composeResultForReview};
